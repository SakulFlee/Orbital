name: Clippy

on:
  pull_request:

permissions:
  contents: write

env:
  CARGO_TERM_COLOR: always

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Cache
      uses: actions/cache@v4.2.0
      with:
        path: target/
        key: target

    - name: Rust channel
      run: rustup default stable

    - name: Rust update
      run: rustup update

    - name: Install Blender
      run: apt-get install -y blender

    - name: Clippy
      run: cargo clippy --fix
      
    - name: Commit & Push if changes are found
      run: |
        git config --global user.name '@SakulFlee | Lukas Weber'
        git config --global user.email 'dev@sakul-flee.de'
        git commit -am "Automated clippy run"
        git push
      continue-on-error: true
